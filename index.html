<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Survival ‚Üí Stability System</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
  :root{
    --bg:#0b1220;
    --card:#121a2f;
    --muted:#9aa3b2;
    --green:#22c55e;
    --red:#ef4444;
    --amber:#f59e0b;
    --blue:#3b82f6;
    --orange:#fb923c;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:#e5e7eb;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell;
  }
  .wrap{max-width:980px; margin:0 auto; padding:16px}
  h1{margin:6px 0 12px; font-size:22px}
  .sub{color:var(--muted); font-size:13px}
  .grid{display:grid; grid-template-columns:1fr; gap:14px}
  .card{
    background:linear-gradient(180deg,#121a2f,#0f1730);
    border-radius:14px; padding:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
  }
  label{font-size:12px; color:var(--muted)}
  input,select,button{
    width:100%; padding:10px 12px; border-radius:10px;
    border:1px solid #1f2a4d; background:#0b132b; color:#e5e7eb;
    outline:none;
  }
  .row{display:grid; grid-template-columns:repeat(2,1fr); gap:10px}
  .row3{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
  button{
    background:var(--green); color:#052e16; font-weight:700; border:none;
    cursor:pointer;
  }
  .pill{
    padding:8px 10px; border-radius:10px; font-size:13px; font-weight:600;
  }
  .ok{background:#063d1e; color:#86efac}
  .warn{background:#3b2a00; color:#fde68a}
  .bad{background:#3b0a0a; color:#fecaca}
  table{width:100%; border-collapse:collapse}
  th,td{padding:8px; border-bottom:1px solid #1f2a4d; font-size:13px}
  th{color:var(--muted); text-align:left}
  .charts{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .chartbox{
    background:#0b132b; border-radius:12px; padding:10px;
  }
  .chartbox h4{margin:4px 0 8px; font-size:14px; color:#c7d2fe}
  canvas{max-width:100%; height:220px !important}
  .donut{height:260px !important}
  .footer{color:var(--muted); font-size:12px; margin-top:6px}
</style>
</head>

<body>
<div class="wrap">
  <h1>üí∏ Survival ‚Üí Stability System</h1>
  <div class="sub">Daily log ‚Ä¢ Local memory ‚Ä¢ Google Sheet backup ‚Ä¢ Next-day guidance</div>

  <!-- ENTRY -->
  <div class="card grid">
    <h3>üìÖ Daily Entry</h3>
    <div class="row">
      <div>
        <label>Month</label>
        <select id="month">
          <option>January</option><option>February</option><option>March</option>
          <option>April</option><option>May</option><option>June</option>
          <option>July</option><option>August</option><option>September</option>
          <option>October</option><option>November</option><option>December</option>
        </select>
      </div>
      <div>
        <label>Salary received today (‚Çπ)</label>
        <input id="salary" type="number" value="0"/>
      </div>
    </div>
    <div class="row3">
      <div>
        <label>Trading Withdraw Today (‚Çπ)</label>
        <input id="withdraw" type="number" value="0"/>
      </div>
      <div>
        <label>Grocery (‚Çπ)</label>
        <input id="grocery" type="number" value="0"/>
      </div>
      <div>
        <label>Travel (‚Çπ)</label>
        <input id="travel" type="number" value="0"/>
      </div>
    </div>
    <div class="row">
      <div>
        <label>Other Essential (‚Çπ)</label>
        <input id="other" type="number" value="0"/>
      </div>
      <div>
        <label>Mood</label>
        <select id="mood">
          <option>ok</option><option>tired</option><option>stressed</option>
        </select>
      </div>
    </div>
    <button onclick="saveToday()">Analyze ‚Ä¢ Save ‚Ä¢ Guide</button>
  </div>

  <!-- TODAY SUMMARY -->
  <div class="card">
    <h3>üìå Today Summary</h3>
    <div id="todayLine" class="pill ok">‚Äî</div>
    <div id="advice" class="pill warn" style="margin-top:8px">‚Äî</div>
  </div>

  <!-- CURRENT MONTH SUMMARY -->
  <div class="card">
    <h3>üóìÔ∏è Current Month Summary</h3>
    <div id="monthLine" class="pill warn">‚Äî</div>
    <table>
      <thead><tr><th>Date</th><th>W</th><th>E</th><th>B</th></tr></thead>
      <tbody id="monthRows"></tbody>
    </table>
  </div>

  <!-- HISTORY -->
  <div class="card">
    <h3>üóÇÔ∏è History (All)</h3>
    <table>
      <thead><tr><th>Date</th><th>Month</th><th>W</th><th>E</th><th>B</th></tr></thead>
      <tbody id="allRows"></tbody>
    </table>
  </div>

  <!-- VISUALS -->
  <div class="card">
    <h3>üìä Today Visual</h3>
    <div class="charts">
      <div class="chartbox">
        <h4>Expense Split (Today)</h4>
        <canvas id="donutToday" class="donut"></canvas>
      </div>
      <div class="chartbox">
        <h4>Withdraw vs Expense (Today)</h4>
        <canvas id="barToday"></canvas>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üìä Current Month Visual</h3>
    <div class="charts">
      <div class="chartbox">
        <h4>Expense Split (Month)</h4>
        <canvas id="donutMonth" class="donut"></canvas>
      </div>
      <div class="chartbox">
        <h4>Withdraw vs Expense (Month)</h4>
        <canvas id="barMonth"></canvas>
      </div>
    </div>
  </div>

  <div class="footer">Rule: Survival &gt; Profit</div>
</div>

<script>
/* ===== CONFIG ===== */
const STORAGE_KEY = 'financeData';
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbycZmT_n66WVFc4t3CFyo7UM7mQg1BGeKHbcE04wH3o4waopuTvcJ44JCkDloMqOyuFtg/exec';

/* ===== UTILS ===== */
const ‚Çπ = n => '‚Çπ' + (Number(n)||0);
const todayStr = () => {
  const d=new Date(); return d.toLocaleDateString('en-GB');
};
const getData = () => JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
const setData = d => localStorage.setItem(STORAGE_KEY, JSON.stringify(d));
const sum = (arr, k) => arr.reduce((a,b)=>a+(Number(b[k])||0),0);

/* ===== SAVE ===== */
function saveToday(){
  const rec = {
    date: todayStr(),
    month: document.getElementById('month').value,
    salary: +document.getElementById('salary').value||0,
    withdraw: +document.getElementById('withdraw').value||0,
    grocery: +document.getElementById('grocery').value||0,
    travel: +document.getElementById('travel').value||0,
    other: +document.getElementById('other').value||0,
    mood: document.getElementById('mood').value
  };
  rec.totalExpense = rec.grocery + rec.travel + rec.other;
  rec.balance = rec.withdraw - rec.totalExpense;

  const all = getData();
  all.push(rec);
  setData(all);

  // send to sheet (order must match header)
  fetch(SHEET_URL,{
    method:'POST', mode:'no-cors',
    body: new URLSearchParams({
      Date: rec.date,
      Month: rec.month,
      Salary: rec.salary,
      Withdraw: rec.withdraw,
      Grocery: rec.grocery,
      Travel: rec.travel,
      Other: rec.other,
      Total_Expense: rec.totalExpense,
      Mood: rec.mood,
      Net_Balance: rec.balance
    })
  }).catch(()=>{});

  render();
}

/* ===== RENDER ===== */
let donutToday, barToday, donutMonth, barMonth;

function render(){
  const all = getData();
  const today = all.filter(r=>r.date===todayStr()).slice(-1)[0];

  // Today summary
  if(today){
    document.getElementById('todayLine').className = 'pill ok';
    document.getElementById('todayLine').textContent =
      `Withdraw ${‚Çπ(today.withdraw)} | Expense ${‚Çπ(today.totalExpense)} | Balance ${‚Çπ(today.balance)}`;
    document.getElementById('advice').className = 'pill ' + (today.totalExpense>800?'bad':'warn');
    document.getElementById('advice').textContent =
      today.totalExpense>800 ? '‚ö† Expense high. Tomorrow limit ‚Çπ400' : '‚úÖ Discipline OK. Trade carefully';
  }else{
    document.getElementById('todayLine').textContent='‚Äî';
    document.getElementById('advice').textContent='‚Äî';
  }

  // Month filter
  const m = document.getElementById('month').value;
  const monthData = all.filter(r=>r.month===m);

  // Month summary line
  document.getElementById('monthLine').textContent =
    `Salary ${‚Çπ(sum(monthData,'salary'))} | Withdraw ${‚Çπ(sum(monthData,'withdraw'))} | Expense ${‚Çπ(sum(monthData,'totalExpense'))}`;

  // Tables
  document.getElementById('monthRows').innerHTML = monthData.map(r =>
    `<tr><td>${r.date}</td><td>${‚Çπ(r.withdraw)}</td><td>${‚Çπ(r.totalExpense)}</td><td>${‚Çπ(r.balance)}</td></tr>`
  ).join('');

  document.getElementById('allRows').innerHTML = all.map(r =>
    `<tr><td>${r.date}</td><td>${r.month}</td><td>${‚Çπ(r.withdraw)}</td><td>${‚Çπ(r.totalExpense)}</td><td>${‚Çπ(r.balance)}</td></tr>`
  ).join('');

  // Charts data
  const t = today || {grocery:0,travel:0,other:0,withdraw:0,totalExpense:0};
  const mAgg = {
    grocery: sum(monthData,'grocery'),
    travel: sum(monthData,'travel'),
    other: sum(monthData,'other'),
    withdraw: sum(monthData,'withdraw'),
    totalExpense: sum(monthData,'totalExpense')
  };

  // Destroy old
  [donutToday,barToday,donutMonth,barMonth].forEach(c=>c&&c.destroy());

  donutToday = new Chart(document.getElementById('donutToday'),{
    type:'doughnut',
    data:{labels:['Grocery','Travel','Other'],
      datasets:[{data:[t.grocery,t.travel,t.other], backgroundColor:['#22c55e','#3b82f6','#fb923c']}]},
    options:{responsive:true, plugins:{legend:{labels:{color:'#e5e7eb'}}}}
  });

  barToday = new Chart(document.getElementById('barToday'),{
    type:'bar',
    data:{labels:['Withdraw','Expense'],
      datasets:[{data:[t.withdraw,t.totalExpense], backgroundColor:['#22c55e','#ef4444']}]},
    options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{ticks:{color:'#e5e7eb'}}, x:{ticks:{color:'#e5e7eb'}}}}
  });

  donutMonth = new Chart(document.getElementById('donutMonth'),{
    type:'doughnut',
    data:{labels:['Grocery','Travel','Other'],
      datasets:[{data:[mAgg.grocery,mAgg.travel,mAgg.other], backgroundColor:['#22c55e','#3b82f6','#fb923c']}]},
    options:{responsive:true, plugins:{legend:{labels:{color:'#e5e7eb'}}}}
  });

  barMonth = new Chart(document.getElementById('barMonth'),{
    type:'bar',
    data:{labels:['Withdraw','Expense'],
      datasets:[{data:[mAgg.withdraw,mAgg.totalExpense], backgroundColor:['#22c55e','#ef4444']}]},
    options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{ticks:{color:'#e5e7eb'}}, x:{ticks:{color:'#e5e7eb'}}}}
  });
}

render();
</script>
</body>
</html>
