<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Survival â†’ Stability System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui, -apple-system;
  background:#0b1220;
  color:#fff;
}
.container{max-width:900px;margin:auto;padding:16px}
.card{
  background:#121b33;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
}
h2{margin:0 0 12px}
input,select,button{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  margin-bottom:10px;
}
button{
  background:#22c55e;
  color:#000;
  font-weight:700;
  cursor:pointer;
}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.badge{padding:10px;border-radius:8px;margin-bottom:8px}
.green{background:#16a34a}
.red{background:#dc2626}
.yellow{background:#ca8a04}
canvas{max-width:100%;height:220px!important}
table{width:100%;border-collapse:collapse}
td,th{border-bottom:1px solid #1f2a44;padding:8px;text-align:center}
</style>
</head>

<body>
<div class="container">

<!-- ENTRY -->
<div class="card">
<h2>ðŸ“… Daily Entry</h2>

<input type="date" id="date">
<select id="month">
<option>January</option><option>February</option><option>March</option>
<option>April</option><option>May</option><option>June</option>
<option>July</option><option>August</option><option>September</option>
<option>October</option><option>November</option><option>December</option>
</select>

<input id="salary" type="number" placeholder="Salary received today">
<input id="withdraw" type="number" placeholder="Trading Withdraw">
<input id="grocery" type="number" placeholder="Grocery">
<input id="travel" type="number" placeholder="Travel">
<input id="other" type="number" placeholder="Other">
<select id="mood">
<option>ok</option><option>stressed</option><option>tired</option>
</select>

<button onclick="saveData()">Analyze â€¢ Save â€¢ Guide</button>
</div>

<!-- TODAY SUMMARY -->
<div class="card">
<h2>ðŸ“Œ Today Summary</h2>
<div id="todaySummary"></div>
</div>

<!-- MONTH SUMMARY -->
<div class="card">
<h2>ðŸ“… Current Month Summary</h2>
<div id="monthSummary"></div>
<table id="monthTable"></table>
</div>

<!-- VISUAL -->
<div class="card">
<h2>ðŸ“Š Visual</h2>
<canvas id="pie"></canvas>
<canvas id="bar"></canvas>
</div>

</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbzgLzec9RnzGaSNihHebDuD2AEJS40GRUj0lfBqaGFk4zxTugxV4Q-pOdqx6JlGYgLyGg/exec";

let pieChart, barChart, allData=[];

async function fetchData(){
  const r=await fetch(SCRIPT_URL);
  allData=await r.json();
  render();
}
fetchData();

function saveData(){
  const payload={
    date:date.value,
    month:month.value,
    salary:+salary.value||0,
    withdraw:+withdraw.value||0,
    grocery:+grocery.value||0,
    travel:+travel.value||0,
    other:+other.value||0,
    mood:mood.value
  };
  fetch(SCRIPT_URL,{method:"POST",body:JSON.stringify(payload)})
  .then(()=>fetchData());
}

function render(){
  if(!allData.length) return;
  const today=allData[allData.length-1];

  const expense=today.grocery+today.travel+today.other;
  const balance=today.withdraw-expense;

  todaySummary.innerHTML=`
  <div class="badge green">Withdraw â‚¹${today.withdraw} | Expense â‚¹${expense} | Balance â‚¹${balance}</div>
  ${expense>500?'<div class="badge red">Expense high. Tomorrow limit â‚¹400</div>':''}
  <div class="badge yellow">Rule: Survival > Profit</div>`;

  const monthName=today.month;
  const monthData=allData.filter(d=>d.month===monthName);

  let mw=0,me=0;
  monthTable.innerHTML="<tr><th>Date</th><th>W</th><th>E</th><th>B</th></tr>";
  monthData.forEach(d=>{
    const e=d.grocery+d.travel+d.other;
    mw+=d.withdraw; me+=e;
    monthTable.innerHTML+=`<tr><td>${d.date}</td><td>${d.withdraw}</td><td>${e}</td><td>${d.withdraw-e}</td></tr>`;
  });

  monthSummary.innerHTML=
  `<div class="badge yellow">Withdraw â‚¹${mw} | Expense â‚¹${me}</div>`;

  drawCharts(today);
}

function drawCharts(d){
  if(pieChart) pieChart.destroy();
  if(barChart) barChart.destroy();

  pieChart=new Chart(pie,{
    type:"doughnut",
    data:{
      labels:["Grocery","Travel","Other"],
      datasets:[{data:[d.grocery,d.travel,d.other],
      backgroundColor:["#22c55e","#3b82f6","#f97316"]}]
    }
  });

  barChart=new Chart(bar,{
    type:"bar",
    data:{
      labels:["Withdraw","Expense"],
      datasets:[{data:[d.withdraw,d.grocery+d.travel+d.other],
      backgroundColor:["#16a34a","#dc2626"]}]
    },
    options:{plugins:{legend:{display:false}}}
  });
}
</script>
</body>
</html>
