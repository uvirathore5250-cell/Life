<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survival ‚Üí Stability System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 15px;
}
h1 { color: #38bdf8; }
.small { font-size: 13px; color: #9ca3af; }

.box {
  background: #020617;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 10px;
}

label { display:block; margin-top:8px; }
input, select {
  width:100%;
  padding:8px;
  margin-top:5px;
  border-radius:6px;
  border:none;
}

button {
  margin-top:15px;
  padding:12px;
  width:100%;
  background:#22c55e;
  color:black;
  font-size:16px;
  border:none;
  border-radius:8px;
}

.alert {
  padding:12px;
  margin-top:10px;
  border-radius:8px;
}
.green { background:#16a34a; }
.yellow { background:#ca8a04; }
.red { background:#dc2626; }
</style>
</head>

<body>

<h1>üí∏ Survival ‚Üí Stability System</h1>
<p class="small">
Safe local storage ‚Ä¢ Cloud backup ‚Ä¢ Next-day guidance  
<br>(Refresh ke baad bhi guidance & charts dikhenge)
</p>

<!-- DAILY ENTRY -->
<div class="box">
<h3>üìÖ Daily Entry</h3>

<label>Month</label>
<select id="month">
  <option>February</option>
  <option>March</option>
  <option>April</option>
  <option>May</option>
  <option>June</option>
  <option>July</option>
  <option>August+</option>
</select>

<label>Salary received today (‚Çπ)</label>
<input type="number" id="salary" value="0">

<label>Trading Withdraw Today (‚Çπ)</label>
<input type="number" id="withdraw" value="0">

<label>Grocery (‚Çπ)</label>
<input type="number" id="grocery" value="0">

<label>Travel (‚Çπ)</label>
<input type="number" id="travel" value="0">

<label>Other Essential (‚Çπ)</label>
<input type="number" id="other" value="0">

<label>Mood</label>
<select id="mood">
  <option>ok</option>
  <option>tired</option>
  <option>stressed</option>
</select>

<button onclick="analyze()">Analyze ‚Ä¢ Save ‚Ä¢ Guide</button>
</div>

<!-- GUIDANCE -->
<div class="box">
<h3>üß† System Guidance</h3>
<div id="result"></div>
</div>

<!-- CHARTS -->
<div class="box">
<h3>üìä Visual Summary</h3>
<canvas id="expensePie" height="200"></canvas>
<br>
<canvas id="withdrawBar" height="200"></canvas>
</div>

<!-- CHART JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ================= CONFIG ================= */

const CLOUD_URL =
"https://script.google.com/macros/s/AKfycbycZmT_n66WVFc4t3CFyo7UM7mQg1BGeKHbcE04wH3o4waopuTvcJ44JCkDloMqOyuFtg/exec";

const STORAGE_KEY = "financeHistory_survival_final_v1";

/* ================= STORAGE ================= */

let history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

/* ================= NEXT DAY GUIDE ================= */

function nextDayGuide(last) {
  let g = "<div class='alert yellow'>üìÖ NEXT DAY GUIDANCE</div>";

  if (last.mood !== "ok") {
    g += "<div class='alert red'>‚ùå NO TRADING tomorrow. Rest priority.</div>";
  } else {
    g += "<div class='alert green'>‚úÖ Trading allowed (strict discipline).</div>";
  }

  if (last.totalExpense > 500) {
    g += "<div class='alert red'>‚ö†Ô∏è Expense high today. Tomorrow limit = ‚Çπ400.</div>";
  } else {
    g += "<div class='alert green'>üëç Expense controlled. Tomorrow limit = ‚Çπ400‚Äì500.</div>";
  }

  if ((last.withdraw - last.totalExpense) <= 0) {
    g += "<div class='alert red'>üõë Balance tight. Essentials only tomorrow.</div>";
  }

  g += "<div class='alert'>üéØ Rule: Survival > Profit</div>";
  return g;
}

/* ================= CHARTS ================= */

let pieChart, barChart;

function renderCharts(last) {
  if (!last) return;

  // PIE / DONUT
  const pieCtx = document.getElementById("expensePie").getContext("2d");
  if (pieChart) pieChart.destroy();

  pieChart = new Chart(pieCtx, {
    type: "doughnut",
    data: {
      labels: ["Grocery", "Travel", "Other"],
      datasets: [{
        data: [last.grocery, last.travel, last.other],
        backgroundColor: ["#22c55e", "#3b82f6", "#f97316"]
      }]
    },
    options: { plugins: { legend: { position: "bottom" } } }
  });

  // BAR
  const barCtx = document.getElementById("withdrawBar").getContext("2d");
  if (barChart) barChart.destroy();

  barChart = new Chart(barCtx, {
    type: "bar",
    data: {
      labels: ["Withdraw", "Expense"],
      datasets: [{
        data: [last.withdraw, last.totalExpense],
        backgroundColor: ["#16a34a", "#dc2626"]
      }]
    },
    options: { plugins: { legend: { display: false } } }
  });
}

/* ================= MAIN ANALYZE ================= */

function analyze() {
  const entry = {
    date: new Date().toLocaleDateString(),
    month: month.value,
    salary: +salary.value,
    withdraw: +withdraw.value,
    grocery: +grocery.value,
    travel: +travel.value,
    other: +other.value,
    mood: mood.value
  };

  entry.totalExpense = entry.grocery + entry.travel + entry.other;

  history.push(entry);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(history));

  fetch(CLOUD_URL, {
    method: "POST",
    body: JSON.stringify({ ...entry, netBalance: entry.withdraw - entry.totalExpense })
  });

  let msg = "";
  msg += "<div class='alert green'>üíæ Saved (local + Google Sheet)</div>";
  msg += `<div class='alert'>Withdraw: ‚Çπ${entry.withdraw}</div>`;
  msg += `<div class='alert'>Expense: ‚Çπ${entry.totalExpense}</div>`;
  msg += `<div class='alert'>Balance: ‚Çπ${entry.withdraw - entry.totalExpense}</div>`;
  msg += nextDayGuide(entry);

  result.innerHTML = msg;
  renderCharts(entry);
}

/* ================= LOAD LAST STATE ================= */

function renderLastOnLoad() {
  if (history.length === 0) return;
  const last = history[history.length - 1];
  result.innerHTML = nextDayGuide(last);
  renderCharts(last);
}

window.onload = renderLastOnLoad;

/* ================= ELEMENTS ================= */

const month = document.getElementById("month");
const salary = document.getElementById("salary");
const withdraw = document.getElementById("withdraw");
const grocery = document.getElementById("grocery");
const travel = document.getElementById("travel");
const other = document.getElementById("other");
const mood = document.getElementById("mood");
const result = document.getElementById("result");
</script>

</body>
</html>
