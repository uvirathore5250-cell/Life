<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survival ‚Üí Stability Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  padding:12px;
}
h1{color:#38bdf8;}
.small{font-size:12px;color:#9ca3af}

.box{
  background:#020617;
  padding:12px;
  margin-bottom:12px;
  border-radius:10px;
}

label{display:block;margin-top:6px}
input,select{
  width:100%;
  padding:7px;
  margin-top:4px;
  border:none;
  border-radius:6px;
}

button{
  width:100%;
  padding:10px;
  margin-top:10px;
  background:#22c55e;
  color:black;
  border:none;
  border-radius:8px;
  font-size:15px;
}

.alert{
  padding:8px;
  border-radius:6px;
  margin-top:6px;
  font-size:14px;
}
.green{background:#16a34a}
.red{background:#dc2626}
.yellow{background:#ca8a04}

table{
  width:100%;
  font-size:13px;
  margin-top:6px;
}
td,th{
  padding:6px;
  border-bottom:1px solid #334155;
  text-align:center;
}

.chart-box{
  max-width:320px;
  margin:10px auto;
}
canvas{
  width:100% !important;
  height:220px !important;
}
</style>
</head>

<body>

<h1>üí∏ Survival ‚Üí Stability</h1>
<p class="small">
Daily ‚Ä¢ Current Month ‚Ä¢ History<br>
Refresh safe ‚Ä¢ Clean visuals ‚Ä¢ Detailed guidance
</p>

<!-- DAILY ENTRY -->
<div class="box">
<h3>üìÖ Daily Entry</h3>

<label>Month</label>
<select id="month">
<option>February</option>
<option>March</option>
<option>April</option>
<option>May</option>
<option>June</option>
<option>July</option>
<option>August</option>
</select>

<label>Salary (‚Çπ)</label>
<input id="salary" type="number" value="0">

<label>Withdraw (‚Çπ)</label>
<input id="withdraw" type="number" value="0">

<label>Grocery (‚Çπ)</label>
<input id="grocery" type="number" value="0">

<label>Travel (‚Çπ)</label>
<input id="travel" type="number" value="0">

<label>Other (‚Çπ)</label>
<input id="other" type="number" value="0">

<label>Mood</label>
<select id="mood">
<option>ok</option>
<option>tired</option>
<option>stressed</option>
</select>

<button onclick="saveEntry()">Save ‚Ä¢ Analyze</button>
</div>

<!-- TODAY -->
<div class="box">
<h3>üìå Today Summary</h3>
<div id="todayBox"></div>
</div>

<!-- MONTH -->
<div class="box">
<h3>üìÜ Current Month</h3>
<div id="monthSummary"></div>
<table id="monthTable"></table>
</div>

<!-- HISTORY -->
<div class="box">
<h3>üóÇ History (All)</h3>
<table id="historyTable"></table>
</div>

<!-- VISUAL -->
<div class="box">
<h3>üìä Visual</h3>

<div class="chart-box">
  <canvas id="pie"></canvas>
</div>

<div class="chart-box">
  <canvas id="bar"></canvas>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const STORAGE_KEY = "finance_survival_v3_1";
let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let pieChart, barChart;

/* ---------- SAVE ---------- */
function saveEntry(){
  const e = {
    date: new Date().toLocaleDateString(),
    month: month.value,
    salary: +salary.value,
    withdraw: +withdraw.value,
    g: +grocery.value,
    t: +travel.value,
    o: +other.value,
    mood: mood.value
  };
  e.exp = e.g + e.t + e.o;
  e.balance = e.withdraw - e.exp;

  data.push(e);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  render();
}

/* ---------- DETAILED REPORT (PEHLE JAISE) ---------- */
function detailedReport(e){
  let msg = "";

  msg += `<div class="alert green">
    Withdraw ‚Çπ${e.withdraw} | Expense ‚Çπ${e.exp} | Balance ‚Çπ${e.balance}
  </div>`;

  if(e.exp > 500){
    msg += `<div class="alert red">
      ‚ö† Expense high today. Kal limit ‚Çπ400.
    </div>`;
  } else {
    msg += `<div class="alert green">
      üëç Expense controlled.
    </div>`;
  }

  if(e.mood !== "ok"){
    msg += `<div class="alert red">
      üß† Mood low ‚Äì kal trading avoid.
    </div>`;
  } else {
    msg += `<div class="alert green">
      ‚úÖ Trading allowed (strict discipline).
    </div>`;
  }

  msg += `<div class="alert yellow">
    üéØ Rule: Survival > Profit
  </div>`;

  return msg;
}

/* ---------- RENDER ---------- */
function render(){
  const today = new Date().toLocaleDateString();
  const currentMonth = month.value;

  const todayEntry = data.filter(x => x.date === today).at(-1);
  const monthData = data.filter(x => x.month === currentMonth);

  /* TODAY */
  todayBox.innerHTML = todayEntry
    ? detailedReport(todayEntry)
    : "No entry today";

  /* MONTH SUMMARY */
  let sw=0, se=0, ss=0;
  monthData.forEach(x=>{
    sw+=x.withdraw;
    se+=x.exp;
    ss+=x.salary;
  });

  monthSummary.innerHTML = `
    <div class="alert yellow">
      Salary ‚Çπ${ss} | Withdraw ‚Çπ${sw} | Expense ‚Çπ${se}
    </div>
  `;

  monthTable.innerHTML =
    "<tr><th>Date</th><th>W</th><th>E</th><th>B</th></tr>" +
    monthData.map(x =>
      `<tr>
        <td>${x.date}</td>
        <td>${x.withdraw}</td>
        <td>${x.exp}</td>
        <td>${x.balance}</td>
      </tr>`
    ).join("");

  /* HISTORY */
  historyTable.innerHTML =
    "<tr><th>Date</th><th>Month</th><th>W</th><th>E</th><th>B</th></tr>" +
    data.map(x =>
      `<tr>
        <td>${x.date}</td>
        <td>${x.month}</td>
        <td>${x.withdraw}</td>
        <td>${x.exp}</td>
        <td>${x.balance}</td>
      </tr>`
    ).join("");

  renderCharts(todayEntry, sw, se);
}

/* ---------- CHARTS ---------- */
function renderCharts(today, sw, se){
  if(pieChart) pieChart.destroy();
  if(barChart) barChart.destroy();

  pieChart = new Chart(pie.getContext("2d"),{
    type:"doughnut",
    data:{
      labels:["Grocery","Travel","Other"],
      datasets:[{
        data:[
          today?.g || 0,
          today?.t || 0,
          today?.o || 0
        ],
        backgroundColor:["#22c55e","#3b82f6","#f97316"]
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{position:"bottom"}}
    }
  });

  barChart = new Chart(bar.getContext("2d"),{
    type:"bar",
    data:{
      labels:["Withdraw","Expense"],
      datasets:[{
        data:[sw,se],
        backgroundColor:["#16a34a","#dc2626"]
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{display:false}}
    }
  });
}

/* ---------- LOAD ---------- */
window.onload = render;

/* ---------- ELEMENTS ---------- */
const month = document.getElementById("month");
const salary = document.getElementById("salary");
const withdraw = document.getElementById("withdraw");
const grocery = document.getElementById("grocery");
const travel = document.getElementById("travel");
const other = document.getElementById("other");
const mood = document.getElementById("mood");

const todayBox = document.getElementById("todayBox");
const monthSummary = document.getElementById("monthSummary");
const monthTable = document.getElementById("monthTable");
const historyTable = document.getElementById("historyTable");

const pie = document.getElementById("pie");
const bar = document.getElementById("bar");
</script>

</body>
</html>
