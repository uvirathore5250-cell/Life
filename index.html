<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survival Finance</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system;
  background:#0b1020;
  color:#fff;
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.card{
  background:#121a33;
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}
h2{
  margin:0 0 10px 0;
}
input,select{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:none;
  font-size:15px;
}
button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:#22c55e;
  color:#000;
  font-weight:700;
  font-size:16px;
  margin-top:12px;
}
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.summary{
  padding:10px;
  border-radius:10px;
  margin-top:8px;
}
.green{background:#16a34a;}
.red{background:#dc2626;}
.yellow{background:#ca8a04;}
canvas{
  max-width:100%;
  height:220px !important;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
td,th{
  padding:8px;
  border-bottom:1px solid #1f2937;
}
</style>
</head>

<body>
<div class="container">

<!-- ================= ENTRY ================= -->
<div class="card">
<h2>üìÖ Daily Entry</h2>

<input type="date" id="date">

<select id="month">
  <option>January</option><option>February</option><option>March</option>
  <option>April</option><option>May</option><option>June</option>
  <option>July</option><option>August</option><option>September</option>
  <option>October</option><option>November</option><option>December</option>
</select>

<input type="number" id="salary" placeholder="Salary received today ‚Çπ">
<input type="number" id="withdraw" placeholder="Withdraw ‚Çπ">

<div class="row">
  <input type="number" id="grocery" placeholder="Grocery ‚Çπ">
  <input type="number" id="travel" placeholder="Travel ‚Çπ">
</div>

<input type="number" id="other" placeholder="Other ‚Çπ">

<select id="mood">
  <option>ok</option>
  <option>stressed</option>
  <option>tired</option>
</select>

<button onclick="saveData()">Analyze ¬∑ Save ¬∑ Guide</button>
</div>

<!-- ================= TODAY SUMMARY ================= -->
<div class="card">
<h2>üìå Today Summary</h2>
<div id="todayBox"></div>
</div>

<!-- ================= MONTH SUMMARY ================= -->
<div class="card">
<h2>üìÜ Current Month Summary</h2>
<div id="monthBox"></div>
</div>

<!-- ================= HISTORY ================= -->
<div class="card">
<h2>üìÅ History</h2>
<table id="historyTable"></table>
</div>

<!-- ================= VISUAL ================= -->
<div class="card">
<h2>üìä Visual</h2>
<canvas id="pieChart"></canvas>
<canvas id="barChart"></canvas>
</div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxFcD-thZfQdrrjZfiOh5Y0z7ZwONJLb7lfn_-LmCw5bB2pOyax5riGBV--pz_YhQX9EQ/exec";

let pieChart, barChart;

// -------- SAVE DATA --------
function saveData(){
  const payload = {
    date: date.value,
    month: month.value,
    salary: salary.value,
    withdraw: withdraw.value,
    grocery: grocery.value,
    travel: travel.value,
    other: other.value,
    mood: mood.value
  };

  fetch(API,{
    method:"POST",
    body:JSON.stringify(payload)
  })
  .then(r=>r.json())
  .then(res=>{
    loadData();
    alert("Saved successfully");
  });
}

// -------- LOAD DATA --------
function loadData(){
  fetch(API)
  .then(r=>r.json())
  .then(data=>{
    if(!data.length) return;

    const today = data[data.length-1];

    todayBox.innerHTML = `
      <div class="summary green">
      Withdraw ‚Çπ${today.withdraw} | Expense ‚Çπ${today.totalExpense} | Balance ‚Çπ${today.netBalance}
      </div>
    `;

    const month = today.month;
    const monthData = data.filter(d=>d.month===month);

    let mw=0, me=0;
    monthData.forEach(d=>{
      mw+=Number(d.withdraw);
      me+=Number(d.totalExpense);
    });

    monthBox.innerHTML = `
      <div class="summary yellow">
      Withdraw ‚Çπ${mw} | Expense ‚Çπ${me}
      </div>
    `;

    renderHistory(data);
    renderCharts(today);
  });
}

// -------- HISTORY --------
function renderHistory(data){
  let html="<tr><th>Date</th><th>Month</th><th>W</th><th>E</th><th>B</th></tr>";
  data.slice(-10).reverse().forEach(d=>{
    html+=`<tr>
      <td>${d.date}</td>
      <td>${d.month}</td>
      <td>${d.withdraw}</td>
      <td>${d.totalExpense}</td>
      <td>${d.netBalance}</td>
    </tr>`;
  });
  historyTable.innerHTML=html;
}

// -------- CHARTS --------
function renderCharts(d){
  if(pieChart) pieChart.destroy();
  if(barChart) barChart.destroy();

  pieChart = new Chart(pieChartEl,{
    type:"doughnut",
    data:{
      labels:["Grocery","Travel","Other"],
      datasets:[{
        data:[d.grocery,d.travel,d.other],
        backgroundColor:["#22c55e","#3b82f6","#f97316"]
      }]
    }
  });

  barChart = new Chart(barChartEl,{
    type:"bar",
    data:{
      labels:["Withdraw","Expense"],
      datasets:[{
        data:[d.withdraw,d.totalExpense],
        backgroundColor:["#16a34a","#dc2626"]
      }]
    },
    options:{plugins:{legend:{display:false}}}
  });
}

const pieChartEl = document.getElementById("pieChart");
const barChartEl = document.getElementById("barChart");

loadData();
</script>

</body>
</html>
